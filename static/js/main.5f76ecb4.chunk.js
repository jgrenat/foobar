(this["webpackJsonpalma-foobar"]=this["webpackJsonpalma-foobar"]||[]).push([[0],{11:function(t,e,n){},12:function(t,e,n){},13:function(t,e,n){},15:function(t,e,n){"use strict";n.r(e);var o,r,a=n(2),c=n.n(a),i=n(5),b=n.n(i),u=(n(11),n(12),n(3)),s=(n(13),n(1)),j=n(6);function l(t){var e=Object(a.useMemo)((function(){return h([d(),d()])}),[]),n=Object(a.useState)({foobarCount:0,fooCount:0,barCount:0,robots:t?h(t):e,lastHandledFrame:0}),c=Object(u.a)(n,2),i=c[0],b=c[1];var j=Array.from(i.robots.values()),l={foobarCount:i.foobarCount,fooCount:i.fooCount,barCount:i.barCount};return{robots:j,resources:l,changeRobotJob:function(t,e){var n=i.robots.get(t);if(n&&n.job!==e){var a=new Map(i.robots);a.set(t,Object(s.a)(Object(s.a)({},n),{},{job:r.Switching,targetJob:e,state:o.Idle}));var c=Object(s.a)(Object(s.a)({},i),{},{robots:a});b(c)}},isDone:j.length>=20,tick:function(t){if(!(j.length>=20)){var e=i.lastHandledFrame+t,n=j.reduce((function(t,n){return function(t,e,n){if(t.state!==o.Working)return e;switch(t.job){case r.Switching:return t.jobEndTime<=n?f(Object(s.a)(Object(s.a)({},t),{},{job:t.targetJob,state:o.Idle,targetJob:void 0}),e):e;case r.MiningFoo:if(t.jobEndTime<=n){var a=Object(s.a)(Object(s.a)({},t),{},{state:o.Idle});return Object(s.a)(Object(s.a)({},f(a,e)),{},{fooCount:e.fooCount+1})}return e;case r.MiningBar:if(t.jobEndTime<=n){var c=Object(s.a)(Object(s.a)({},t),{},{state:o.Idle});return Object(s.a)(Object(s.a)({},f(c,e)),{},{barCount:e.barCount+1})}return e;case r.AssemblingFoobar:if(t.jobEndTime>n)return e;var i=f(Object(s.a)(Object(s.a)({},t),{},{state:o.Idle}),e);return Math.random()<=.6?Object(s.a)(Object(s.a)({},i),{},{foobarCount:i.foobarCount+1}):Object(s.a)(Object(s.a)({},i),{},{barCount:i.barCount+1});case r.BuyingRobot:default:return e}}(n,t,e)}),i),a=function(t){return Array.from(t.robots.values())}(n).reduce((function(t,n){return function(t,e,n){if(t.state!==o.Idle)return e;switch(t.job){case r.Switching:case r.MiningFoo:case r.MiningBar:var a=n+O(t.job);return f(Object(s.a)(Object(s.a)({},t),{},{state:o.Working,jobEndTime:a}),e);case r.AssemblingFoobar:if(e.fooCount>=1&&e.barCount>=1){var c=n+O(t.job),i=f(Object(s.a)(Object(s.a)({},t),{},{state:o.Working,jobEndTime:c}),e);return Object(s.a)(Object(s.a)({},i),{},{fooCount:e.fooCount-1,barCount:e.barCount-1})}return e;case r.BuyingRobot:var b=Math.floor(Math.min(e.foobarCount/3,e.fooCount/6)),u=new Map(e.robots);return Array.from(new Array(b),d).forEach((function(t){return u.set(t.id,t)})),Object(s.a)(Object(s.a)({},e),{},{robots:u,foobarCount:e.foobarCount-3*b,fooCount:e.fooCount-6*b})}}(n,t,e)}),n);b(Object(s.a)(Object(s.a)({},a),{},{lastHandledFrame:e}))}}}}function d(){return{id:Object(j.a)(),state:o.Idle,job:r.MiningFoo}}function f(t,e){var n=Array.from(e.robots.values()).map((function(e){return e.id===t.id?t:e})),o=new Map(n.map((function(t){return[t.id,t]})));return Object(s.a)(Object(s.a)({},e),{},{robots:o})}function O(t){switch(t){case r.Switching:return 5e3;case r.MiningFoo:return 1e3;case r.MiningBar:return 1500*Math.random()+500;case r.AssemblingFoobar:return 2e3;case r.BuyingRobot:return 0}}function h(t){return new Map(t.map((function(t){return[t.id,t]})))}!function(t){t[t.Idle=0]="Idle",t[t.Working=1]="Working"}(o||(o={})),function(t){t.Switching="switching",t.MiningFoo="miningFoo",t.MiningBar="miningBar",t.AssemblingFoobar="assemblingFoobar",t.BuyingRobot="buyingRobot"}(r||(r={}));var g=n(0);function m(t){switch(t){case o.Idle:return"En attente";case o.Working:return"Occup\xe9..."}}var v=function(t){var e=t.number,n=t.robot,a=t.changeJob;return Object(g.jsxs)("div",{className:"robotCard"+(n.state===o.Idle?" robotCard--idle":""),children:[Object(g.jsxs)("h2",{className:"title",children:["Robot ",e]}),Object(g.jsxs)("dl",{children:[Object(g.jsx)("dt",{children:"Boulot"}),Object(g.jsx)("dd",{children:n.job===r.Switching?Object(g.jsx)(g.Fragment,{children:"En train de changer de boulot..."}):Object(g.jsxs)("select",{onChange:function(t){return a(t.target.value)},value:n.job,children:[Object(g.jsx)("option",{value:r.MiningFoo,children:"Miner du Foo"}),Object(g.jsx)("option",{value:r.MiningBar,children:"Miner du Bar"}),Object(g.jsx)("option",{value:r.AssemblingFoobar,children:"Assembler du FooBar"}),Object(g.jsx)("option",{value:r.BuyingRobot,children:"Acheter des robots"})]})}),Object(g.jsx)("dt",{children:"Statut"}),Object(g.jsx)("dd",{children:m(n.state)})]})]})};var C=function(t,e){var n=Object(a.useRef)(t);Object(a.useEffect)((function(){n.current=t}),[t]),Object(a.useEffect)((function(){if(null!==e){var t=setInterval((function(){return n.current()}),e);return function(){return clearInterval(t)}}}),[e])};var x=function(){var t=l(),e=t.robots,n=t.resources,o=t.changeRobotJob,r=t.isDone,c=t.tick,i=Object(a.useState)(performance.now()),b=Object(u.a)(i,2),s=b[0],j=b[1];return C((function(){var t=performance.now(),e=t-s;j(t),c(e)}),r?null:100),Object(g.jsxs)("main",{children:[Object(g.jsx)("h1",{className:"mainTitle",children:"Foobartory"}),r&&Object(g.jsx)("p",{className:"success","aria-live":"assertive",children:"Bravo, vous avez atteint 20 robots !"}),Object(g.jsx)("aside",{className:"resources",children:Object(g.jsxs)("dl",{children:[Object(g.jsx)("dt",{children:"Foo"}),Object(g.jsx)("dd",{children:n.fooCount}),Object(g.jsx)("dt",{children:"Bar"}),Object(g.jsx)("dd",{children:n.barCount}),Object(g.jsx)("dt",{children:"Foobar"}),Object(g.jsx)("dd",{children:n.foobarCount}),Object(g.jsx)("dt",{children:"Robots"}),Object(g.jsxs)("dd",{"aria-live":"polite","aria-valuenow":e.length,"aria-valuemin":2,"aria-valuemax":20,children:[e.length,"/20"]})]})}),Object(g.jsx)("section",{className:"robots",children:e.map((function(t,e){return Object(g.jsx)(v,{number:e+1,robot:t,changeJob:function(e){return o(t.id,e)}},e)}))})]})},F=function(t){t&&n.e(3).then(n.bind(null,16)).then((function(e){var n=e.getCLS,o=e.getFID,r=e.getFCP,a=e.getLCP,c=e.getTTFB;n(t),o(t),r(t),a(t),c(t)}))};b.a.render(Object(g.jsx)(c.a.StrictMode,{children:Object(g.jsx)(x,{})}),document.getElementById("root")),F(console.log)}},[[15,1,2]]]);
//# sourceMappingURL=main.5f76ecb4.chunk.js.map